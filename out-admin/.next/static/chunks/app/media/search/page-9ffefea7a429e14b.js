(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[122],{4073:function(e,t,a){Promise.resolve().then(a.bind(a,4145))},4145:function(e,t,a){"use strict";let r,s;a.r(t),a.d(t,{default:function(){return N}});var l=a(7437),i=a(2265),n=a(9376),c=a(3602),d=a(5978),o=a(738),u=a(62),x=a(3301),m=a(257);{let e=["NEXT_PUBLIC_FIREBASE_API_KEY","NEXT_PUBLIC_FIREBASE_AUTH_DOMAIN","NEXT_PUBLIC_FIREBASE_PROJECT_ID","NEXT_PUBLIC_FIREBASE_STORAGE_BUCKET","NEXT_PUBLIC_FIREBASE_MESSAGING_SENDER_ID","NEXT_PUBLIC_FIREBASE_APP_ID"].filter(e=>!m.env[e]);e.length>0&&console.warn("Missing Firebase environment variables:",e.join(", "))}r=(0,o.C6)().length?(0,o.C6)()[0]:(0,o.ZF)({apiKey:"AIzaSyDi8DiIdhLCJO9bXAzBGdeKwBBi7gYPXHs",authDomain:"ayumi-f6bd2.firebaseapp.com",projectId:"ayumi-f6bd2",storageBucket:"ayumi-f6bd2.firebasestorage.app",messagingSenderId:"561071971625",appId:"1:561071971625:web:0e382383fbb444c0066b38"}),s=(0,d.ad)(r),(0,u.cF)(r),(0,x.v0)(r);let g=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};try{if(!s)return console.error("Firestore is not initialized"),[];let t=(0,d.hJ)(s,"categories"),a=(0,d.IO)(t);return e.isRecommended&&(a=(0,d.IO)(a,(0,d.ar)("isRecommended","==",!0))),a=(0,d.IO)(a,(0,d.Xo)("order","asc")),(await (0,d.PL)(a)).docs.map(e=>{let t=e.data();return{id:e.id,...t}})}catch(e){return console.error("Error getting categories:",e),[]}},h=async()=>{try{if(!s)return console.error("Firestore is not initialized"),[];let e=(0,d.hJ)(s,"tags"),t=(0,d.IO)(e,(0,d.Xo)("name","asc"));return(await (0,d.PL)(t)).docs.map(e=>{let t=e.data();return{id:e.id,...t}})}catch(e){return console.error("Error getting tags:",e),[]}};function f(e){let{filters:t,onChange:a}=e,[r,s]=(0,i.useState)([]),[n,c]=(0,i.useState)([]),[d,o]=(0,i.useState)(!0);(0,i.useEffect)(()=>{(async()=>{try{let[e,t]=await Promise.all([g(),h()]);s(e),c(t)}catch(e){console.error("Error loading filters:",e)}finally{o(!1)}})()},[]);let u=e=>{a({...t,categoryId:e})},x=e=>{a({...t,tagId:e})};return d?(0,l.jsx)("div",{className:"bg-white rounded-lg shadow-md p-6",children:"読み込み中..."}):(0,l.jsxs)("div",{className:"bg-white rounded-lg shadow-md p-6",children:[(0,l.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,l.jsx)("h2",{className:"text-xl font-bold text-gray-900",children:"絞り込み検索"}),(t.categoryId||t.tagId)&&(0,l.jsx)("button",{onClick:()=>{a({categoryId:"",tagId:"",keyword:""})},className:"text-sm text-blue-600 hover:text-blue-800",children:"クリア"})]}),(0,l.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"カテゴリー"}),(0,l.jsxs)("select",{value:t.categoryId,onChange:e=>u(e.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",children:[(0,l.jsx)("option",{value:"",children:"すべて"}),r.map(e=>(0,l.jsx)("option",{value:e.id,children:e.name},e.id))]})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"タグ"}),(0,l.jsxs)("select",{value:t.tagId,onChange:e=>x(e.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",children:[(0,l.jsx)("option",{value:"",children:"すべて"}),n.map(e=>(0,l.jsx)("option",{value:e.id,children:e.name},e.id))]})]})]})]})}var p=a(7648),y=a(3145);function b(e){let{article:t}=e;return(0,l.jsxs)(p.default,{href:"/media/articles/".concat(t.slug),className:"block bg-white rounded-lg shadow-md hover:shadow-xl transition-shadow overflow-hidden",children:[t.featuredImage&&(0,l.jsx)("div",{className:"relative w-full h-48 bg-gray-200",children:(0,l.jsx)(y.default,{src:t.featuredImage,alt:t.title,fill:!0,className:"object-cover",sizes:"(max-width: 768px) 100vw, (max-width: 1200px) 50vw, 33vw"})}),(0,l.jsxs)("div",{className:"p-4",children:[(0,l.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-2 line-clamp-2",children:t.title}),t.excerpt&&(0,l.jsx)("p",{className:"text-sm text-gray-600 mb-3 line-clamp-2",children:t.excerpt}),(0,l.jsxs)("div",{className:"flex items-center justify-between text-xs text-gray-500",children:[(0,l.jsx)("span",{children:function(e){let t="string"==typeof e?new Date(e):e,a=t.getFullYear(),r=String(t.getMonth()+1).padStart(2,"0"),s=String(t.getDate()).padStart(2,"0");return"".concat(a,".").concat(r,".").concat(s)}(t.publishedAt)}),(0,l.jsxs)("span",{children:[t.viewCount||0," views"]})]})]})]})}let j=e=>(null==e?void 0:e.toDate)?e.toDate():new Date(e),v=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};try{if(!s)return console.error("Firestore is not initialized"),[];let t=(0,d.hJ)(s,"articles"),a=(0,d.IO)(t,(0,d.ar)("isPublished","==",!0));e.categoryId&&(a=(0,d.IO)(a,(0,d.ar)("categoryIds","array-contains",e.categoryId))),e.tagId&&(a=(0,d.IO)(a,(0,d.ar)("tagIds","array-contains",e.tagId))),a=(0,d.IO)(a,(0,d.Xo)("publishedAt","desc"));let r=e.limitCount||50;a=(0,d.IO)(a,(0,d.b9)(r));let l=(await (0,d.PL)(a)).docs.map(e=>{let t=e.data();return{id:e.id,...t,publishedAt:j(t.publishedAt),updatedAt:j(t.updatedAt)}});if(e.keyword){let t=e.keyword.toLowerCase();l=l.filter(e=>{var a;let r=e.title.toLowerCase().includes(t),s=null===(a=e.excerpt)||void 0===a?void 0:a.toLowerCase().includes(t),l=e.content.toLowerCase().includes(t);return r||s||l})}return l}catch(e){return console.error("Error searching articles:",e),[]}};function I(){let e=(0,n.useSearchParams)().get("q")||"",[t,a]=(0,i.useState)([]),[r,s]=(0,i.useState)(!1),[d,o]=(0,i.useState)({categoryId:"",tagId:"",keyword:e});(0,i.useEffect)(()=>{e&&u(e)},[e]);let u=async e=>{s(!0);try{let t=await v({keyword:e,categoryId:d.categoryId||void 0,tagId:d.tagId||void 0});a(t)}catch(e){console.error("Search error:",e),a([])}finally{s(!1)}};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("section",{className:"mb-8",children:(0,l.jsx)(c.default,{})}),(0,l.jsx)("section",{className:"mb-8",children:(0,l.jsx)(f,{filters:d,onChange:e=>{o(e),(e.keyword||e.categoryId||e.tagId)&&u(e.keyword)}})}),(0,l.jsx)("section",{children:r?(0,l.jsx)("div",{className:"text-center py-12",children:(0,l.jsx)("p",{className:"text-gray-600",children:"検索中..."})}):t.length>0?(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("div",{className:"mb-4",children:(0,l.jsxs)("p",{className:"text-gray-600",children:[t.length,"件の記事が見つかりました"]})}),(0,l.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:t.map(e=>(0,l.jsx)(b,{article:e},e.id))})]}):(0,l.jsx)("div",{className:"text-center py-12",children:(0,l.jsx)("p",{className:"text-gray-600",children:e||d.categoryId||d.tagId?"記事が見つかりませんでした":"検索キーワードを入力してください"})})})]})}function N(){return(0,l.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,l.jsx)("header",{className:"bg-white shadow-sm",children:(0,l.jsx)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4",children:(0,l.jsxs)("div",{className:"flex items-center justify-between",children:[(0,l.jsx)("a",{href:"/media",className:"text-2xl font-bold text-gray-900",children:"ふらっと。"}),(0,l.jsxs)("nav",{className:"hidden md:flex space-x-6",children:[(0,l.jsx)("a",{href:"/media",className:"text-gray-700 hover:text-gray-900",children:"トップ"}),(0,l.jsx)("a",{href:"/media/articles",className:"text-gray-700 hover:text-gray-900",children:"記事一覧"}),(0,l.jsx)("a",{href:"/media/search",className:"text-gray-700 hover:text-gray-900",children:"検索"})]})]})})}),(0,l.jsx)("main",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:(0,l.jsx)(i.Suspense,{fallback:(0,l.jsx)("div",{className:"text-center py-12",children:"読み込み中..."}),children:(0,l.jsx)(I,{})})})]})}},3602:function(e,t,a){"use strict";a.d(t,{default:function(){return i}});var r=a(7437),s=a(2265),l=a(9376);function i(){let[e,t]=(0,s.useState)(""),a=(0,l.useRouter)();return(0,r.jsx)("form",{onSubmit:t=>{t.preventDefault(),e.trim()&&a.push("/media/search?q=".concat(encodeURIComponent(e.trim())))},className:"max-w-3xl mx-auto",children:(0,r.jsxs)("div",{className:"relative",children:[(0,r.jsx)("input",{type:"text",value:e,onChange:e=>t(e.target.value),placeholder:"キーワードで検索（例：車椅子、バリアフリー、おでかけ）",className:"w-full px-6 py-4 text-lg border-2 border-gray-300 rounded-lg focus:outline-none focus:border-blue-500 focus:ring-2 focus:ring-blue-200"}),(0,r.jsx)("button",{type:"submit",className:"absolute right-2 top-1/2 -translate-y-1/2 bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700 transition-colors",children:"検索"})]})})}}},function(e){e.O(0,[139,358,609,129,971,117,744],function(){return e(e.s=4073)}),_N_E=e.O()}]);