(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[122],{4073:function(e,t,r){Promise.resolve().then(r.bind(r,8946))},8946:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return v}});var a=r(7437),n=r(2265),s=r(9376),i=r(3602),o=r(1424),l=r(6797);function c(e){let{filters:t,onChange:r}=e,[s,i]=(0,n.useState)([]),[c,d]=(0,n.useState)([]),[u,m]=(0,n.useState)(!0);(0,n.useEffect)(()=>{(async()=>{try{let[e,t]=await Promise.all([(0,o.CP)(),(0,l.NJ)()]);i(e),d(t)}catch(e){console.error("Error loading filters:",e)}finally{m(!1)}})()},[]);let h=e=>{r({...t,categoryId:e})},g=e=>{r({...t,tagId:e})};return u?(0,a.jsx)("div",{className:"bg-white rounded-lg shadow-md p-6",children:"読み込み中..."}):(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-md p-6",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,a.jsx)("h2",{className:"text-xl font-bold text-gray-900",children:"絞り込み検索"}),(t.categoryId||t.tagId)&&(0,a.jsx)("button",{onClick:()=>{r({categoryId:"",tagId:"",keyword:""})},className:"text-sm text-blue-600 hover:text-blue-800",children:"クリア"})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"カテゴリー"}),(0,a.jsxs)("select",{value:t.categoryId,onChange:e=>h(e.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",children:[(0,a.jsx)("option",{value:"",children:"すべて"}),s.map(e=>(0,a.jsx)("option",{value:e.id,children:e.name},e.id))]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"タグ"}),(0,a.jsxs)("select",{value:t.tagId,onChange:e=>g(e.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",children:[(0,a.jsx)("option",{value:"",children:"すべて"}),c.map(e=>(0,a.jsx)("option",{value:e.id,children:e.name},e.id))]})]})]})]})}var d=r(7648),u=r(8461),m=r.n(u);function h(e){let{article:t}=e;return(0,a.jsxs)(d.default,{href:"/media/articles/".concat(t.slug),className:"block bg-white rounded-lg shadow-md hover:shadow-xl transition-shadow overflow-hidden",children:[t.featuredImage&&(0,a.jsx)("div",{className:"relative w-full h-48 bg-gray-200",children:(0,a.jsx)(m(),{src:t.featuredImage,alt:t.title,fill:!0,className:"object-cover",sizes:"(max-width: 768px) 100vw, (max-width: 1200px) 50vw, 33vw"})}),(0,a.jsxs)("div",{className:"p-4",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-2 line-clamp-2",children:t.title}),t.excerpt&&(0,a.jsx)("p",{className:"text-sm text-gray-600 mb-3 line-clamp-2",children:t.excerpt}),(0,a.jsxs)("div",{className:"flex items-center justify-between text-xs text-gray-500",children:[(0,a.jsx)("span",{children:function(e){let t="string"==typeof e?new Date(e):e,r=t.getFullYear(),a=String(t.getMonth()+1).padStart(2,"0"),n=String(t.getDate()).padStart(2,"0");return"".concat(r,".").concat(a,".").concat(n)}(t.publishedAt)}),(0,a.jsxs)("span",{children:[t.viewCount||0," views"]})]})]})]})}var g=r(5978),x=r(4257),f=r(1202);let p=e=>(null==e?void 0:e.toDate)?e.toDate():new Date(e),y=async function(){var e;let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};(null===(e=t.keyword)||void 0===e?void 0:e.trim())&&(0,f.oc)(t.keyword).catch(e=>{console.error("Failed to record search:",e)});try{if(!x.db)return console.error("Firestore is not initialized"),[];let e=(0,g.hJ)(x.db,"articles"),r=(0,g.IO)(e,(0,g.ar)("isPublished","==",!0));t.categoryId&&(r=(0,g.IO)(r,(0,g.ar)("categoryIds","array-contains",t.categoryId))),t.tagId&&(r=(0,g.IO)(r,(0,g.ar)("tagIds","array-contains",t.tagId))),r=(0,g.IO)(r,(0,g.Xo)("publishedAt","desc"));let a=t.limitCount||50;r=(0,g.IO)(r,(0,g.b9)(a));let n=(await (0,g.PL)(r)).docs.map(e=>{let t=e.data();return{id:e.id,...t,publishedAt:p(t.publishedAt),updatedAt:p(t.updatedAt)}});if(t.keyword){let e=t.keyword.toLowerCase();n=n.filter(t=>{var r;let a=t.title.toLowerCase().includes(e),n=null===(r=t.excerpt)||void 0===r?void 0:r.toLowerCase().includes(e),s=t.content.toLowerCase().includes(e);return a||n||s})}return n}catch(e){return console.error("Error searching articles:",e),[]}};function b(){let e=(0,s.useSearchParams)().get("q")||"",[t,r]=(0,n.useState)([]),[o,l]=(0,n.useState)(!1),[d,u]=(0,n.useState)({categoryId:"",tagId:"",keyword:e});(0,n.useEffect)(()=>{e&&m(e)},[e]);let m=async e=>{l(!0);try{let t=await y({keyword:e,categoryId:d.categoryId||void 0,tagId:d.tagId||void 0});r(t)}catch(e){console.error("Search error:",e),r([])}finally{l(!1)}};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("section",{className:"mb-8",children:(0,a.jsx)(i.default,{})}),(0,a.jsx)("section",{className:"mb-8",children:(0,a.jsx)(c,{filters:d,onChange:e=>{u(e),(e.keyword||e.categoryId||e.tagId)&&m(e.keyword)}})}),(0,a.jsx)("section",{children:o?(0,a.jsx)("div",{className:"text-center py-12",children:(0,a.jsx)("p",{className:"text-gray-600",children:"検索中..."})}):t.length>0?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"mb-4",children:(0,a.jsxs)("p",{className:"text-gray-600",children:[t.length,"件の記事が見つかりました"]})}),(0,a.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:t.map(e=>(0,a.jsx)(h,{article:e},e.id))})]}):(0,a.jsx)("div",{className:"text-center py-12",children:(0,a.jsx)("p",{className:"text-gray-600",children:e||d.categoryId||d.tagId?"記事が見つかりませんでした":"検索キーワードを入力してください"})})})]})}function v(){return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("script",{dangerouslySetInnerHTML:{__html:"\n            if (window.location.search.includes('q=') || \n                window.location.search.includes('categoryId=') || \n                window.location.search.includes('tagId=')) {\n              const meta = document.createElement('meta');\n              meta.name = 'robots';\n              meta.content = 'noindex, nofollow';\n              document.head.appendChild(meta);\n            }\n          "}}),(0,a.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,a.jsx)("header",{className:"bg-white shadow-sm",children:(0,a.jsx)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("a",{href:"/media",className:"text-2xl font-bold text-gray-900",children:"ふらっと。"}),(0,a.jsxs)("nav",{className:"hidden md:flex space-x-6",children:[(0,a.jsx)("a",{href:"/media",className:"text-gray-700 hover:text-gray-900",children:"トップ"}),(0,a.jsx)("a",{href:"/media/articles",className:"text-gray-700 hover:text-gray-900",children:"記事一覧"}),(0,a.jsx)("a",{href:"/media/search",className:"text-gray-700 hover:text-gray-900",children:"検索"})]})]})})}),(0,a.jsx)("main",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:(0,a.jsx)(n.Suspense,{fallback:(0,a.jsx)("div",{className:"text-center py-12",children:"読み込み中..."}),children:(0,a.jsx)(b,{})})})]})]})}},3602:function(e,t,r){"use strict";r.d(t,{default:function(){return i}});var a=r(7437),n=r(2265),s=r(9376);function i(){let[e,t]=(0,n.useState)(""),r=(0,s.useRouter)();return(0,a.jsx)("form",{onSubmit:t=>{t.preventDefault(),e.trim()&&r.push("/media/search?q=".concat(encodeURIComponent(e.trim())))},className:"max-w-3xl mx-auto",children:(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)("input",{type:"text",value:e,onChange:e=>t(e.target.value),placeholder:"キーワードで検索（例：車椅子、バリアフリー、おでかけ）",className:"w-full px-6 py-4 text-lg border-2 border-gray-300 rounded-lg focus:outline-none focus:border-blue-500 focus:ring-2 focus:ring-blue-200"}),(0,a.jsx)("button",{type:"submit",className:"absolute right-2 top-1/2 -translate-y-1/2 bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700 transition-colors",children:"検索"})]})})}},1424:function(e,t,r){"use strict";r.d(t,{CP:function(){return s},tG:function(){return i}});var a=r(5978),n=r(4257);let s=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};try{if(!n.db)return console.error("Firestore is not initialized"),[];let t=(0,a.hJ)(n.db,"categories"),r=(0,a.IO)(t);return e.isRecommended&&(r=(0,a.IO)(r,(0,a.ar)("isRecommended","==",!0))),r=(0,a.IO)(r,(0,a.Xo)("order","asc")),(await (0,a.PL)(r)).docs.map(e=>{let t=e.data();return{id:e.id,...t}})}catch(e){return console.error("Error getting categories:",e),[]}},i=s},4257:function(e,t,r){"use strict";let a,n,s,i;r.d(t,{I8:function(){return i},db:function(){return n},tO:function(){return s}});var o=r(738),l=r(5978),c=r(62),d=r(3301),u=r(257);{let e=["NEXT_PUBLIC_FIREBASE_API_KEY","NEXT_PUBLIC_FIREBASE_AUTH_DOMAIN","NEXT_PUBLIC_FIREBASE_PROJECT_ID","NEXT_PUBLIC_FIREBASE_STORAGE_BUCKET","NEXT_PUBLIC_FIREBASE_MESSAGING_SENDER_ID","NEXT_PUBLIC_FIREBASE_APP_ID"].filter(e=>!u.env[e]);e.length>0&&console.warn("Missing Firebase environment variables:",e.join(", "))}a=(0,o.C6)().length?(0,o.C6)()[0]:(0,o.ZF)({apiKey:"AIzaSyDi8DiIdhLCJO9bXAzBGdeKwBBi7gYPXHs",authDomain:"ayumi-f6bd2.firebaseapp.com",projectId:"ayumi-f6bd2",storageBucket:"ayumi-f6bd2.firebasestorage.app",messagingSenderId:"561071971625",appId:"1:561071971625:web:0e382383fbb444c0066b38"}),n=(0,l.ad)(a),s=(0,c.cF)(a),i=(0,d.v0)(a)},1202:function(e,t,r){"use strict";r.d(t,{VK:function(){return i},oc:function(){return s}});var a=r(5978),n=r(4257);let s=async e=>{if(!n.db)throw Error("Firestore is not initialized");try{let t=e.trim().toLowerCase();if(!t)return;let r=(0,a.JU)(n.db,"searchHistory",t);(await (0,a.QT)(r)).exists()?await (0,a.pl)(r,{count:(0,a.nP)(1),lastSearchedAt:(0,a.Bt)()},{merge:!0}):await (0,a.pl)(r,{keyword:t,count:1,lastSearchedAt:(0,a.Bt)()})}catch(e){console.error("Error recording search:",e)}},i=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10;if(!n.db)return console.error("Firestore is not initialized"),[];try{let t=(0,a.hJ)(n.db,"searchHistory"),r=(0,a.IO)(t,(0,a.Xo)("count","desc"),(0,a.b9)(e));return(await (0,a.PL)(r)).docs.map(e=>{var t;let r=e.data();return{id:e.id,keyword:r.keyword,count:r.count,lastSearchedAt:(null===(t=r.lastSearchedAt)||void 0===t?void 0:t.toDate())||new Date}})}catch(e){return console.error("Error getting popular keywords:",e),[]}}},6797:function(e,t,r){"use strict";r.d(t,{NJ:function(){return s},Ys:function(){return i}});var a=r(5978),n=r(4257);let s=async()=>{try{if(!n.db)return console.error("Firestore is not initialized"),[];let e=(0,a.hJ)(n.db,"tags"),t=(0,a.IO)(e,(0,a.Xo)("name","asc"));return(await (0,a.PL)(t)).docs.map(e=>{let t=e.data();return{id:e.id,...t}})}catch(e){return console.error("Error getting tags:",e),[]}},i=s},7648:function(e,t,r){"use strict";r.d(t,{default:function(){return n.a}});var a=r(2972),n=r.n(a)},9376:function(e,t,r){"use strict";var a=r(5475);r.o(a,"usePathname")&&r.d(t,{usePathname:function(){return a.usePathname}}),r.o(a,"useRouter")&&r.d(t,{useRouter:function(){return a.useRouter}}),r.o(a,"useSearchParams")&&r.d(t,{useSearchParams:function(){return a.useSearchParams}})},8461:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e,t){for(var r in t)Object.defineProperty(e,r,{enumerable:!0,get:t[r]})}(t,{default:function(){return l},getImageProps:function(){return o}});let a=r(7043),n=r(5346),s=r(5878),i=a._(r(5084));function o(e){let{props:t}=(0,n.getImgProps)(e,{defaultLoader:i.default,imgConf:{deviceSizes:[640,750,828,1080,1200,1920,2048,3840],imageSizes:[16,32,48,64,96,128,256,384],path:"/_next/image/",loader:"default",dangerouslyAllowSVG:!1,unoptimized:!1}});for(let[e,r]of Object.entries(t))void 0===r&&delete t[e];return{props:t}}let l=s.Image}},function(e){e.O(0,[358,139,972,933,878,971,117,744],function(){return e(e.s=4073)}),_N_E=e.O()}]);